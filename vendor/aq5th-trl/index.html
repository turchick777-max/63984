<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <script>if(screen.width<768){document.querySelector('meta[name="viewport"]').setAttribute("content","width=device-width,initial-scale=1,viewport-fit=cover")}</script>
  <title>AQUINTAQA — Screen 5 (TRL Snapshot)</title>
  <style>
    :root{
      --page:#FAFAFA;
      --scheme:#D3D3D3;

      --text:#0b0b0b;
      --muted:#6f6f6f;

      --chipBorder: rgba(0,0,0,.18);
      --tickOpacity: .12;

      --focus: rgb(43,127,255);

      --radius: 28px;
      --shadow: 0 1px 2px rgba(0,0,0,.04), 0 2px 6px rgba(0,0,0,.05);

      --btnSize: 42px;
      --railH: 170px;
      --tickH: 9px;
      --markerW: 1px;

      --contentMax: 1200px;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      background: var(--page);
      color: var(--text);
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }

    .screen{
      min-height: 100vh;
      display:flex;
      align-items:flex-start;
      justify-content:center;
      padding: 56px 32px;
    }

    .wrap{
      width:100%;
      max-width: var(--contentMax);
    }

    /* Top: headline + micro (как в ТЗ) */
    .top{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 28px;
      align-items:start;
      margin-bottom: 80px;
    }

    .micro{
      font-size: 14px;
      line-height: 1.4;
      letter-spacing: .01em;
      color: var(--muted);
      margin: 12px 0 0 0;
    }

    .headline{
      margin:0;
      font-weight: 500;
      letter-spacing: -0.02em;
      line-height: 1.02;
    }
    .headline .l1{
      display:block;
      font-size: 64px;
      opacity: .95;
      margin-bottom: 12px;
    }
    .headline .l2{
      display:block;
      font-size: 48px;
      white-space: nowrap;
    }

    /* Right column intentionally minimal (как реф: пустое пространство/текст можно добавить позже) */
    .topRight{
      color: var(--muted);
      font-size: 14px;
      line-height: 20px;
      padding-top: 22px;
    }

    /* Scheme card */
    .card{
      background: var(--scheme);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 60px 36px 60px 36px;
      position: relative;
      overflow: hidden;
    }

    /* Timeline layout */
    .timeline{
      display:grid;
      grid-template-columns: auto 1fr auto;
      align-items:center;
      gap: 20px;
    }

    .tbtn{
      width: var(--btnSize);
      height: var(--btnSize);
      border-radius: 999px;
      border: 0;
      background: rgba(255,255,255,.7);
      box-shadow: 0 0 0 1px rgba(0,0,0,.06), 0 1px 2px rgba(0,0,0,.04);
      display:inline-flex;
      align-items:center;
      justify-content:center;
      cursor:pointer;
      transition: transform .25s ease, background .25s ease;
      user-select:none;
    }
    .tbtn:hover{ background: rgba(255,255,255,.9); }
    .tbtn:active{ transform: scale(.98); }
    .tbtn:disabled{ opacity:.45; cursor:not-allowed; }
    .tbtn:focus-visible{
      outline: 1.5px solid var(--focus);
      outline-offset: 2px;
    }

    .railWrap{
      position: relative;
      height: 300px;
      width: 100%;
    }

    /* ticks line */
    .ticks{
      position:absolute;
      left: 8%;
      right: 8%;
      top: calc(50% - (var(--tickH) / 2));
      height: var(--tickH);
      background:
        url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 9 9'%3E%3Crect width='0.5' height='9' fill='black' opacity='0.12'/%3E%3Crect width='0.5' x='8.5' height='9' fill='black' opacity='0.12'/%3E%3C/svg%3E");
      background-size: 9px 9px;
      background-position: top center;
    }

    /* markers container */
    .markers{
      position:absolute;
      left: 8%;
      right: 8%;
      top: 0;
      bottom: 0;
      pointer-events: none;
    }

    .marker{
      position:absolute;
      top: 0;
      width: 24px; /* click target */
      height: 100%;
      margin-left: -12px;
      border: 0;
      padding: 0;
      background: transparent;
      pointer-events: auto;
      cursor: pointer;
      outline: none;
    }

    .marker .bar{
      position:absolute;
      left: 50%;
      top: 50%;
      width: var(--markerW);
      height: var(--tickH);
      margin-left: calc(-1 * var(--markerW) / 2);
      margin-top: calc(-1 * var(--tickH) / 2);
      background: #000;
      opacity: .9;
      transform-origin: center;
      transition: transform .3s ease;
      transform: scale(1);
    }

    .marker .halo{
      position:absolute;
      left: 50%;
      top: 50%;
      width: 1.1875rem;
      height: 160px;
      margin-left: calc(-1.1875rem/2);
      margin-top: -80px;
      border-radius: 999px;
      border: 1px solid var(--chipBorder);
      opacity: 0;
      transition: opacity .25s ease;
      background: rgba(255,255,255,.15);
    }

    .marker.is-active{
      z-index: 10;
    }
    .marker.is-active .bar{
      transform: scale(1.6, 13.5);
    }
    .marker.is-active .halo{
      opacity: 1;
    }
    /* Inactive markers - dimmed bar */
    .marker.is-inactive.is-active .bar{
      opacity: 0.25;
    }
    .marker.is-inactive.is-active .halo{
      opacity: 0.3;
    }

    .marker:focus-visible .halo{
      outline: 1.5px solid var(--focus);
      outline-offset: 2px;
    }

    /* Tooltip - disabled */
    .tip{
      display: none;
    }
    .tip .t1{
      font-size: 12px;
      line-height: 16px;
      font-weight: 600;
      margin: 0 0 6px 0;
      color: var(--text);
    }
    .tip .t2{
      font-size: 12px;
      line-height: 16px;
      margin: 0;
      color: var(--muted);
    }

    /* Text panel inside card (title above marker + desc under) */
    .markerTitle{
      position: absolute;
      left: 50%;
      bottom: calc(100% + 4px);
      transform: translateX(-50%);
      font-size: 17px;
      line-height: 22px;
      font-weight: 500;
      margin: 0;
      white-space: nowrap;
      opacity: 0;
      transition: opacity .3s ease;
      pointer-events: none;
      color: var(--text);
    }
    .markerDesc{
      position: absolute;
      left: 50%;
      top: calc(100% + 4px);
      transform: translateX(-50%);
      font-size: 15px;
      line-height: 20px;
      margin: 0;
      color: var(--text);
      white-space: nowrap;
      opacity: 0;
      transition: opacity .3s ease;
      pointer-events: none;
    }
    /* Only active marker shows text */
    .marker.is-active .markerTitle,
    .marker.is-active .markerDesc{
      opacity: 1;
    }
    /* Inactive markers when active - slightly dimmed text */
    .marker.is-inactive.is-active .markerTitle,
    .marker.is-inactive.is-active .markerDesc{
      opacity: 0.75;
      color: var(--muted);
    }
    /* Last marker — right-align title so it doesn't overflow the card */
    .marker:last-child .markerTitle{
      left: auto;
      right: -150px;
      transform: none;
      text-align: right;
    }
    .panelDate{
      font-size: 13px;
      line-height: 18px;
      margin: 0;
      color: var(--muted);
    }

    /* Responsive */
    @media (max-width: 860px){
      .top{
        grid-template-columns: 1fr;
      }
      .topRight{ padding-top: 0; }
      .card{ padding: 26px 20px 20px 20px; }
      .ticks, .markers{ left: 10%; right: 10%; }
    }
    @media (max-width: 768px){
      html, body { overflow-y: auto; height: auto; }
      .screen { padding: 24px 16px; min-height: auto; }
      .wrap { padding: 0; }
      .card h2 { font-size: 16px; }
    }

    /* ══════════════════════════════════════════════════
       MOBILE OVERRIDES — phones portrait (≤ 767px)
       Desktop (≥ 768px) is completely untouched.
       ══════════════════════════════════════════════════ */
    @media (max-width: 767px) {

      *, *::before, *::after { box-sizing: border-box; }

      html, body {
        height: auto !important;
        overflow-x: hidden !important;
        overflow-y: auto  !important;
        max-width: 100vw  !important;
      }

      .screen {
        min-height: auto !important;
        padding: 24px 16px calc(24px + env(safe-area-inset-bottom, 0px)) !important;
        position: relative !important;
        overflow-x: hidden;
      }

      .wrap {
        max-width: 100% !important;
        overflow-x: hidden;
      }

      /* ── Header ── */
      .top {
        grid-template-columns: 1fr !important;
        gap: 6px;
        margin-bottom: 20px !important;
      }

      .topRight { display: none !important; }

      .headline .l1 {
        font-size: clamp(26px, 7vw, 44px) !important;
        margin-bottom: 4px;
      }

      .headline .l2 {
        font-size: clamp(16px, 4.5vw, 28px) !important;
        white-space: normal !important;
        word-break: break-word;
      }

      .micro { font-size: 12px; margin-top: 6px; }

      /* ── Card: compact ── */
      .card {
        padding: 20px 14px 16px !important;
        border-radius: 16px;
        overflow: hidden;
      }

      /* ── Timeline buttons ── */
      .timeline { gap: 8px; }

      .tbtn {
        width: 36px !important;
        height: 36px !important;
        flex-shrink: 0;
      }

      /* ── Rail: compact height (text moved to panel below) ── */
      .railWrap { height: 110px !important; }

      .marker .halo {
        height: 70px;
        margin-top: -35px;
      }

      /* ── Floating marker labels: hide — info panel below replaces them ── */
      .markerTitle,
      .markerDesc { display: none !important; }

      /* ── Info panel injected by JS ── */
      .m-trl-panel {
        margin-top: 14px;
        padding: 14px 16px;
        background: rgba(0, 0, 0, 0.05);
        border: 1px solid rgba(0, 0, 0, 0.09);
        border-radius: 12px;
        min-height: 64px;
      }

      .m-trl-title {
        font-size: clamp(13px, 3.5vw, 15px);
        font-weight: 600;
        color: var(--text);
        line-height: 1.35;
        margin-bottom: 5px;
      }

      .m-trl-desc {
        font-size: clamp(11px, 3vw, 13px);
        color: var(--muted);
        line-height: 1.5;
      }

      /* Inactive markers (TRL-1, TRL-2, TRL-9) — dimmed panel */
      .m-trl-panel--inactive {
        opacity: 0.45;
      }
    }

    /* ── Extra small phones ≤ 479px ── */
    @media (max-width: 479px) {

      .screen {
        padding: 18px 12px calc(18px + env(safe-area-inset-bottom, 0px)) !important;
      }

      .headline .l1 { font-size: clamp(22px, 7vw, 34px) !important; }
      .headline .l2 { font-size: clamp(14px, 4.5vw, 22px) !important; }

      .railWrap { height: 100px !important; }

      .marker .halo { height: 60px; margin-top: -30px; }

      .tbtn { width: 32px !important; height: 32px !important; }

      .card { padding: 16px 12px 14px !important; border-radius: 14px; }

      .m-trl-panel { padding: 12px 14px; }
    }

    /* Respect reduced-motion preference */
    @media (prefers-reduced-motion: reduce) {
      .tbtn, .marker .bar, .marker .halo {
        transition: none !important;
        animation: none !important;
      }
    }

    /* ── Lang switcher ── */
    .lang-switch {
      display: flex;
      gap: 2px;
      align-items: center;
      margin-top: 16px;
    }
    .lang-btn {
      background: none;
      border: none;
      color: var(--muted);
      padding: 4px 9px;
      cursor: pointer;
      font: 500 11px Inter, system-ui;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      transition: color 0.18s;
      line-height: 1;
    }
    .lang-btn.active { color: var(--text); }
    .lang-btn:hover  { color: var(--text); }
    .lang-sep { color: rgba(0,0,0,0.2); font-size: 10px; pointer-events: none; user-select: none; }
    @media (max-width: 767px) {
      .lang-switch { margin-top: 10px; }
      .lang-btn { padding: 4px 6px; font-size: 9.5px; }
    }
  </style>
</head>
<body>
  <main class="screen">
    <section class="wrap">
      <div class="top">
        <div>
          <h1 class="headline">
            <span class="l1" id="trl-l1">INVESTOR TEASER</span>
            <span class="l2" id="trl-l2">TRL SNAPSHOT • AQUINTAQA</span>
          </h1>
          <p class="micro" id="trl-micro">Pre-NDA view. Evidence package: Data Room (e-NDA).</p>
          <div class="lang-switch">
            <button class="lang-btn active" data-lang="en" onclick="window.trlSetLang('en')">EN</button>
            <span class="lang-sep">|</span>
            <button class="lang-btn" data-lang="ru" onclick="window.trlSetLang('ru')">RU</button>
          </div>
        </div>
        <div class="topRight">
          <!-- В ТЗ нет отдельного правого текста — оставил минимально.
               Если надо, сюда можно вставить любой copy. -->
        </div>
      </div>

      <div class="card">
        <div class="timeline" id="trlTimeline">
          <button class="tbtn" id="prevBtn" aria-label="Previous">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none">
              <path stroke="currentColor" stroke-width="1.5" d="M10 4 6 8l4 4"/>
            </svg>
          </button>

          <div class="railWrap" aria-label="TRL timeline">
            <div class="ticks" aria-hidden="true"></div>
            <div class="markers" id="markers"></div>
          </div>

          <button class="tbtn" id="nextBtn" aria-label="Next">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none">
              <path stroke="currentColor" stroke-width="1.5" d="m6 12 4-4-4-4"/>
            </svg>
          </button>
        </div>
      </div>
    </section>
  </main>

  <script>
    // Bilingual header data
    var TRL_HEADER = {
      en: {
        l1: 'INVESTOR TEASER',
        l2: 'TRL SNAPSHOT \u2022 AQUINTAQA',
        micro: 'Pre-NDA view. Evidence package: Data Room (e-NDA).'
      },
      ru: {
        l1: '\u0418\u041d\u0412\u0415\u0421\u0422\u0418\u0426\u0418\u041e\u041d\u041d\u042b\u0419 \u0422\u0418\u0417\u0415\u0420',
        l2: 'TRL-\u0421\u041d\u0410\u041f\u0428\u041e\u0422 \u2022 AQUINTAQA',
        micro: '\u041f\u0443\u0431\u043b\u0438\u0447\u043d\u044b\u0439 \u0432\u0438\u0434. \u0414\u043e\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0439 \u043f\u0430\u043a\u0435\u0442: Data Room (e-NDA).'
      }
    };

    // Bilingual TRL stages
    var TRL_DATA = {
      en: [
        { id:1, active:false, title:'TRL-1 \u2014 Basic principles observed',           desc:'TRL framework shown for reference.<br>Active checkpoints: TRL-3 to TRL-8' },
        { id:2, active:false, title:'TRL-2 \u2014 Technology concept formulated',        desc:'TRL framework shown for reference.<br>Active checkpoints: TRL-3 to TRL-8' },
        { id:3, active:true,  title:'TRL-3 \u2014 Core principle proven',                desc:'controlled samples \u2022 repeatable directional effect \u2022<br>baseline conditions' },
        { id:4, active:true,  title:'TRL-4 \u2014 Bench prototype validated',            desc:'instrumented bench runs \u2022 stable control loop \u2022<br>repeatability confirmed' },
        { id:5, active:true,  title:'TRL-5 \u2014 Pilot subsystem validated (relevant feeds)', desc:'relevant feed classes \u2022 config-dependent \u2022<br>before/after results' },
        { id:6, active:true,  title:'TRL-6 \u2014 Integrated pilot demonstrated (\u2265300h, multi-feed)', desc:'\u2265300h continuous runs \u2022 multi-feed \u2022<br>independent lab before/after (e-NDA)' },
        { id:7, active:true,  title:'TRL-7 \u2014 Field pilot (site integration)',       desc:'host site integration \u2022 utilities/controls/monitoring \u2022<br>uptime targets' },
        { id:8, active:true,  title:'TRL-8 \u2014 Pre-commercial system',               desc:'engineered package \u2022 QA/QC & service model \u2022<br>deployment readiness' },
        { id:9, active:false, title:'TRL-9 \u2014 Actual system proven in operational environment', desc:'TRL framework shown for reference.<br>Active checkpoints: TRL-3 to TRL-8' }
      ],
      ru: [
        { id:1, active:false, title:'TRL-1 \u2014 \u041d\u0430\u0431\u043b\u044e\u0434\u0435\u043d\u0438\u0435 \u0431\u0430\u0437\u043e\u0432\u044b\u0445 \u043f\u0440\u0438\u043d\u0446\u0438\u043f\u043e\u0432',   desc:'\u0423\u0440\u043e\u0432\u043d\u0438 TRL \u043f\u0440\u0438\u0432\u0435\u0434\u0435\u043d\u044b \u0434\u043b\u044f \u0441\u043f\u0440\u0430\u0432\u043a\u0438.<br>\u0410\u043a\u0442\u0438\u0432\u043d\u044b\u0435 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442\u044b: TRL-3 \u2014 TRL-8' },
        { id:2, active:false, title:'TRL-2 \u2014 \u041a\u043e\u043d\u0446\u0435\u043f\u0446\u0438\u044f \u0442\u0435\u0445\u043d\u043e\u043b\u043e\u0433\u0438\u0438 \u0441\u0444\u043e\u0440\u043c\u0443\u043b\u0438\u0440\u043e\u0432\u0430\u043d\u0430', desc:'\u0423\u0440\u043e\u0432\u043d\u0438 TRL \u043f\u0440\u0438\u0432\u0435\u0434\u0435\u043d\u044b \u0434\u043b\u044f \u0441\u043f\u0440\u0430\u0432\u043a\u0438.<br>\u0410\u043a\u0442\u0438\u0432\u043d\u044b\u0435 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442\u044b: TRL-3 \u2014 TRL-8' },
        { id:3, active:true,  title:'TRL-3 \u2014 \u041a\u043b\u044e\u0447\u0435\u0432\u043e\u0439 \u043f\u0440\u0438\u043d\u0446\u0438\u043f \u0434\u043e\u043a\u0430\u0437\u0430\u043d',   desc:'\u043a\u043e\u043d\u0442\u0440\u043e\u043b\u0438\u0440\u0443\u0435\u043c\u044b\u0435 \u043e\u0431\u0440\u0430\u0437\u0446\u044b \u2022 \u043f\u043e\u0432\u0442\u043e\u0440\u044f\u0435\u043c\u044b\u0439 \u044d\u0444\u0444\u0435\u043a\u0442 \u2022<br>\u0431\u0430\u0437\u043e\u0432\u044b\u0435 \u0443\u0441\u043b\u043e\u0432\u0438\u044f' },
        { id:4, active:true,  title:'TRL-4 \u2014 \u0421\u0442\u0435\u043d\u0434\u043e\u0432\u044b\u0439 \u043f\u0440\u043e\u0442\u043e\u0442\u0438\u043f \u0432\u0430\u043b\u0438\u0434\u0438\u0440\u043e\u0432\u0430\u043d',   desc:'\u0438\u043d\u0441\u0442\u0440\u0443\u043c\u0435\u043d\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0435 \u0441\u0442\u0435\u043d\u0434\u043e\u0432\u044b\u0435 \u0437\u0430\u043f\u0443\u0441\u043a\u0438 \u2022 \u0441\u0442\u0430\u0431\u0438\u043b\u044c\u043d\u044b\u0439 \u043a\u043e\u043d\u0442\u0443\u0440 \u0443\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u044f \u2022<br>\u043f\u043e\u0432\u0442\u043e\u0440\u044f\u0435\u043c\u043e\u0441\u0442\u044c \u043f\u043e\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043d\u0430' },
        { id:5, active:true,  title:'TRL-5 \u2014 \u041f\u0438\u043b\u043e\u0442\u043d\u0430\u044f \u043f\u043e\u0434\u0441\u0438\u0441\u0442\u0435\u043c\u0430 \u0432\u0430\u043b\u0438\u0434\u0438\u0440\u043e\u0432\u0430\u043d\u0430 (\u0440\u0435\u0430\u043b\u044c\u043d\u044b\u0435 \u0444\u0438\u0434\u044b)', desc:'\u0440\u0435\u0430\u043b\u044c\u043d\u044b\u0435 \u043a\u043b\u0430\u0441\u0441\u044b \u0444\u0438\u0434\u0430 \u2022 \u0437\u0430\u0432\u0438\u0441\u0438\u0442 \u043e\u0442 \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u0438 \u2022<br>\u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u044b \u0434\u043e/\u043f\u043e\u0441\u043b\u0435' },
        { id:6, active:true,  title:'TRL-6 \u2014 \u0418\u043d\u0442\u0435\u0433\u0440\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0438\u043b\u043e\u0442 \u043f\u0440\u043e\u0434\u0435\u043c\u043e\u043d\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043d (\u2265300\u0447, \u043c\u0443\u043b\u044c\u0442\u0438\u0444\u0438\u0434)', desc:'\u2265300\u0447 \u043d\u0435\u043f\u0440\u0435\u0440\u044b\u0432\u043d\u044b\u0445 \u0437\u0430\u043f\u0443\u0441\u043a\u043e\u0432 \u2022 \u043c\u0443\u043b\u044c\u0442\u0438\u0444\u0438\u0434 \u2022<br>\u043d\u0435\u0437\u0430\u0432\u0438\u0441\u0438\u043c\u044b\u0435 \u043b\u0430\u0431\u043e\u0440\u0430\u0442\u043e\u0440\u043d\u044b\u0435 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u044b \u0434\u043e/\u043f\u043e\u0441\u043b\u0435 (e-NDA)' },
        { id:7, active:true,  title:'TRL-7 \u2014 \u041f\u043e\u043b\u0435\u0432\u043e\u0439 \u043f\u0438\u043b\u043e\u0442 (\u0438\u043d\u0442\u0435\u0433\u0440\u0430\u0446\u0438\u044f \u043d\u0430 \u043f\u043b\u043e\u0449\u0430\u0434\u043a\u0435)', desc:'\u0438\u043d\u0442\u0435\u0433\u0440\u0430\u0446\u0438\u044f \u043d\u0430 \u043f\u043b\u043e\u0449\u0430\u0434\u043a\u0435 \u2022 \u043a\u043e\u043c\u043c\u0443\u043d\u0430\u043b\u044c\u043d\u044b\u0435/\u0441\u0438\u0441\u0442\u0435\u043c\u044b \u0443\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u044f \u2022<br>\u0446\u0435\u043b\u0435\u0432\u044b\u0435 \u043f\u043e\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0438 \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u043e\u0441\u0442\u0438' },
        { id:8, active:true,  title:'TRL-8 \u2014 \u041f\u0440\u0435\u0434\u043a\u043e\u043c\u043c\u0435\u0440\u0447\u0435\u0441\u043a\u0430\u044f \u0441\u0438\u0441\u0442\u0435\u043c\u0430', desc:'\u0438\u043d\u0436\u0435\u043d\u0435\u0440\u043d\u044b\u0439 \u043f\u0430\u043a\u0435\u0442 \u2022 QA/QC & \u0441\u0435\u0440\u0432\u0438\u0441\u043d\u0430\u044f \u043c\u043e\u0434\u0435\u043b\u044c \u2022<br>\u0433\u043e\u0442\u043e\u0432\u043d\u043e\u0441\u0442\u044c \u043a \u0440\u0430\u0437\u0432\u0451\u0440\u0442\u044b\u0432\u0430\u043d\u0438\u044e' },
        { id:9, active:false, title:'TRL-9 \u2014 \u0421\u0438\u0441\u0442\u0435\u043c\u0430 \u0434\u043e\u043a\u0430\u0437\u0430\u043d\u0430 \u0432 \u043e\u043f\u0435\u0440\u0430\u0446\u0438\u043e\u043d\u043d\u043e\u0439 \u0441\u0440\u0435\u0434\u0435', desc:'\u0423\u0440\u043e\u0432\u043d\u0438 TRL \u043f\u0440\u0438\u0432\u0435\u0434\u0435\u043d\u044b \u0434\u043b\u044f \u0441\u043f\u0440\u0430\u0432\u043a\u0438.<br>\u0410\u043a\u0442\u0438\u0432\u043d\u044b\u0435 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442\u044b: TRL-3 \u2014 TRL-8' }
      ]
    };

    var currentTrlLang = 'en';

    window.trlSetLang = function(lang) {
      currentTrlLang = lang;
      // Update buttons
      document.querySelectorAll('.lang-btn[data-lang]').forEach(function(btn) {
        btn.classList.toggle('active', btn.getAttribute('data-lang') === lang);
      });
      // Update header texts
      var h = TRL_HEADER[lang];
      document.getElementById('trl-l1').textContent = h.l1;
      document.getElementById('trl-l2').textContent = h.l2;
      document.getElementById('trl-micro').textContent = h.micro;
      // Re-render markers with correct language
      TRL.length = 0;
      TRL_DATA[lang].forEach(function(t) { TRL.push(t); });
      render();
    };

    // TRL text — из ТЗ
    const TRL = [
      {
        id: 1,
        active: false,
        title: "TRL-1 — Basic principles observed",
        desc: "TRL framework shown for reference.<br>Active checkpoints: TRL-3 to TRL-8"
      },
      {
        id: 2,
        active: false,
        title: "TRL-2 — Technology concept formulated",
        desc: "TRL framework shown for reference.<br>Active checkpoints: TRL-3 to TRL-8"
      },
      {
        id: 3,
        active: true,
        title: "TRL-3 — Core principle proven",
        desc: "controlled samples • repeatable directional effect •<br>baseline conditions"
      },
      {
        id: 4,
        active: true,
        title: "TRL-4 — Bench prototype validated",
        desc: "instrumented bench runs • stable control loop •<br>repeatability confirmed"
      },
      {
        id: 5,
        active: true,
        title: "TRL-5 — Pilot subsystem validated (relevant feeds)",
        desc: "relevant feed classes • config-dependent •<br>before/after results"
      },
      {
        id: 6,
        active: true,
        title: "TRL-6 — Integrated pilot demonstrated (≥300h, multi-feed)",
        desc: "≥300h continuous runs • multi-feed •<br>independent lab before/after (e-NDA)"
      },
      {
        id: 7,
        active: true,
        title: "TRL-7 — Field pilot (site integration)",
        desc: "host site integration • utilities/controls/monitoring •<br>uptime targets"
      },
      {
        id: 8,
        active: true,
        title: "TRL-8 — Pre-commercial system",
        desc: "engineered package • QA/QC & service model •<br>deployment readiness"
      },
      {
        id: 9,
        active: false,
        title: "TRL-9 — Actual system proven in operational environment",
        desc: "TRL framework shown for reference.<br>Active checkpoints: TRL-3 to TRL-8"
      },
    ];

    const ACTIVE_MICRO = "Pre-NDA view. Evidence package: Data Room (e-NDA).";
    const markersEl = document.getElementById("markers");
    const prevBtn = document.getElementById("prevBtn");
    const nextBtn = document.getElementById("nextBtn");

    // По умолчанию выберем TRL-3 (первый активный), как логично для "active checkpoints"
    let activeIndex = TRL.findIndex(x => x.id === 3);
    if (activeIndex < 0) activeIndex = 0;

    function setPanel(idx){
      // update markers
      [...markersEl.children].forEach((node, i) => {
        node.classList.toggle("is-active", i === idx);
        node.setAttribute("aria-selected", i === idx ? "true" : "false");
        node.tabIndex = i === idx ? 0 : -1;
      });

      prevBtn.disabled = idx === 0;
      nextBtn.disabled = idx === TRL.length - 1;
    }

    function render(){
      markersEl.innerHTML = "";

      // Равномерное расстояние между TRL: 1..9 равномерно по ширине
      // left% = i/(n-1) * 100
      const n = TRL.length;

      TRL.forEach((t, i) => {
        const btn = document.createElement("button");
        btn.type = "button";
        btn.className = "marker" + (i === activeIndex ? " is-active" : "") + (!t.active ? " is-inactive" : "");
        btn.style.left = (i / (n - 1) * 100) + "%";
        btn.setAttribute("aria-label", t.title);
        btn.addEventListener("click", () => { activeIndex = i; setPanel(activeIndex); });

        btn.addEventListener("keydown", (e) => {
          if(e.key === "Enter" || e.key === " "){
            e.preventDefault();
            activeIndex = i;
            setPanel(activeIndex);
          }
          if(e.key === "ArrowLeft"){
            e.preventDefault();
            activeIndex = Math.max(0, activeIndex - 1);
            setPanel(activeIndex);
          }
          if(e.key === "ArrowRight"){
            e.preventDefault();
            activeIndex = Math.min(n - 1, activeIndex + 1);
            setPanel(activeIndex);
          }
        });

        const bar = document.createElement("div");
        bar.className = "bar";

        const halo = document.createElement("div");
        halo.className = "halo";

        const tip = document.createElement("div");
        tip.className = "tip";
        tip.innerHTML = `
          <p class="t1">${t.title}</p>
          <p class="t2">${t.active ? t.desc : t.desc}</p>
        `;

        const markerTitle = document.createElement("div");
        markerTitle.className = "markerTitle";
        markerTitle.textContent = t.title;

        const markerDesc = document.createElement("div");
        markerDesc.className = "markerDesc";
        markerDesc.innerHTML = t.desc.replace(/ •/g, '&nbsp;•');

        btn.appendChild(bar);
        btn.appendChild(halo);
        btn.appendChild(tip);
        btn.appendChild(markerTitle);
        btn.appendChild(markerDesc);

        markersEl.appendChild(btn);
      });

      prevBtn.addEventListener("click", () => {
        activeIndex = Math.max(0, activeIndex - 1);
        setPanel(activeIndex);
      });
      nextBtn.addEventListener("click", () => {
        activeIndex = Math.min(TRL.length - 1, activeIndex + 1);
        setPanel(activeIndex);
      });

      setPanel(activeIndex);
    }

    render();

    // Init: localStorage + postMessage
    (function() {
      var saved = 'en';
      try { saved = localStorage.getItem('selectedLang') || 'en'; } catch(e) {}
      if (saved !== 'en') window.trlSetLang(saved);
      window.addEventListener('message', function(e) {
        if (e.data && e.data.type === 'setLang') window.trlSetLang(e.data.lang);
      });
    })();
  </script>

  <!-- Mobile: inject info panel below timeline card (replaces floating labels) -->
  <script>
  (function () {
    if (!window.matchMedia('(max-width: 767px)').matches) return;

    var wrap  = document.querySelector('.wrap');
    var card  = document.querySelector('.card');
    if (!wrap || !card) return;

    /* Create the panel */
    var panel = document.createElement('div');
    panel.className = 'm-trl-panel';
    wrap.insertBefore(panel, card.nextSibling);

    function updatePanel(idx) {
      var t = TRL[idx];
      if (!t) return;
      panel.classList.toggle('m-trl-panel--inactive', !t.active);
      panel.innerHTML =
        '<div class="m-trl-title">' + t.title + '</div>' +
        '<div class="m-trl-desc">'  + t.desc.replace(/<br\s*\/?>/gi, ' ') + '</div>';
    }

    /* Patch setPanel so panel updates on every navigation */
    var _orig = setPanel;
    setPanel = function (idx) {
      _orig(idx);
      updatePanel(idx);
    };

    /* Also patch button handlers that modify activeIndex directly */
    document.getElementById('prevBtn').addEventListener('click', function () {
      updatePanel(activeIndex);
    });
    document.getElementById('nextBtn').addEventListener('click', function () {
      updatePanel(activeIndex);
    });

    updatePanel(activeIndex);
  })();
  </script>
</body>
</html>
